// Работа потоков в данное время не поддерживается
ЗавершитьРаботуСистемы();

Заявить РазрешеныПотоки() КАК "Потоки запрещены!";

Процедура Слиять(Знач Массив, Знач Лево, Знач Середина, Знач Право)
	
	Перем Т, ИИ, ЖЖ, Шаг;

	Т = Новый Массив(Массив.Количество());
	
    ИИ = Лево;
	ЖЖ = Середина + 1;
	
	Для Шаг = 0 По Право - Лево Цикл
		
		Если (ЖЖ > Право) Тогда
			НадоИИ = Истина;
		ИначеЕсли ( ИИ <= Середина) И (Массив[ИИ] < Массив[ЖЖ]) Тогда
			НадоИИ = Истина;
		Иначе
			НадоИИ = Ложь;
		КонецЕсли;
		
		Если НадоИИ Тогда
			Т[Шаг] = Массив[ИИ];
			ИИ = ИИ + 1;
        Иначе
			Т[Шаг] = Массив[ЖЖ];
			ЖЖ = ЖЖ + 1;
        КонецЕсли;
		
    КонецЦикла;

	Для Шаг = 0 По Право - Лево
		Массив[Лево + Шаг] = Т[Шаг];
		
КонецПроцедуры

Процедура Сортировка(Знач Массив, Знач ИспользоватьПотоки, Знач Лево = 0, Знач Право = Неопределено)
	
	Если Право = Неопределено
		Право = Массив.ВГраница();
	
	Если Лево = Право
		Возврат;
	
	Середина = Цел((Лево + Право) / 2);
	
	Если ИспользоватьПотоки > 0 Тогда
		Д = Новый Действие("Сортировка");
		Р1 = Д.Фоном(Массив, ИспользоватьПотоки - 1, Лево, Середина);
		Сортировка(Массив, ИспользоватьПотоки - 1, Середина + 1, Право);
		Р1.Ожидать();
	Иначе
		Сортировка(Массив, ИспользоватьПотоки, Лево, Середина);
		Сортировка(Массив, ИспользоватьПотоки, Середина + 1, Право);
	КонецЕсли;
	
	Слиять(Массив, Лево, Середина, Право);
	
КонецПроцедуры

Функция Проверить(М)

	Для Инд = 1 По М.ВГраница()
		Если М[Инд - 1] > М[Инд]
			Возврат "Ошибка!";
			
	Возврат "Успешно";

КонецФункции

СтепеньИспользованияПотоков = 9;
Для Каждого ИспользоватьПотоки Из [0, СтепеньИспользованияПотоков] Цикл

	Г = Новый ГенераторСлучайныхЧисел();
	Размер = 1000;

	М = Новый Массив(Размер);

	Для Инд = 0 По Размер - 1 Цикл
		М[Инд] = Г.СлучайноеЧисло(0, 40) - 20;
	КонецЦикла;

	Сообщить("Начало: ", ТекущаяДата(), "   Размер: ", Размер, "    Потоки: ", ИспользоватьПотоки);

	Сортировка(М, ИспользоватьПотоки);

	Сообщить("Окончание: ", ТекущаяДата());
	Сообщить("Проверка: ", Проверить(М));
	
КонецЦикла;
